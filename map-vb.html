<html>
<head>
<title> test-vb </title>
</head>

<body>
~
<script>

// maybe go() or game() has problem   (because the program can run properly without line 21)



// main 
    let crowd=new Array(20);  // 20 people
    for(let i=0;i<20;i++){
        crowd[i]=new people();
    }
    let Map=new map();  // one map
    while( done(Map)==0 ){ // run until there is only one people left
    	Map.go();
	}
	let ans=0;  // find the winner
	for(let i=0;i<10;i++)
        for(let j=0;j<10;j++)
		    if(Map.m[i][j]!=0)
			    ans=Map.m[i][j];
 /*   for(let i=0;i<10;i++)   // for testing
        for(let j=0;j<10;j++)
		    if(Map.m[i][j]!=-1)
                document.write(Map.m[i][j]+" "); */

// cout 
	document.write(`  
	The winner is contestant  ${ans+1}
	Win  games ${crowd[ans].win}
	The total turn:${Map.turn}`);


// ** class

	class map{
		constructor(){    
		this.m=new Array(10);  //map include a 10*10 square
		for(let i=0;i<10;i++){
			this.m[i]=new Array(10);
		}
		this.turn=0;  // and record how many turns
		for(let i=0;i<10;i++){  // if no one stand on the spot, record -1
			for(let j=0;j<10;j++)
				this.m[i][j]=-1;
		}
		for(let i=0;i<20;i++){   //initiallize map, stand people from 0 to 19 (20 people)
			let x=Math.floor(Math.random()*10);
			let y=Math.floor(Math.random()*10);
			if(this.m[x][y]==-1)  
				this.m[x][y]=i;
			else
				i--;
		}
		}
	go(){   // move all people in the map, if two people meet each other, call game(A,B)
		let result={
			"CUL" : [[0,1],[1,1],[1,0]],
			"CUR" : [[0,-1],[1,-1],[1,0]],
			"CDL" : [[0,1],[-1,1],[-1,0]],
			"CDR" : [[0,-1],[-1,-1],[-1,0]],
			"CU" : [[0,-1],[0,1],[1,-1],[1,1],[1,0]],
			"CD" : [[0,-1],[0,1],[-1,-1],[-1,1],[-1,0]],
			"CL" : [[1,0],[1,1],[-1,0],[-1,1],[0,1]],
			"CR" : [[1,0],[1,-1],[-1,0],[-1,-1],[0,-1]],
			"C" : [[1,0],[1,1],[1,-1],[-1,0],[-1,1],[-1,-1],[0,1],[0,-1]],
		};
		for(let y=0;y<10;y++){
			for(let x=0;x<10;x++){
                let content="C";
			    if(this.m[y][x]!=-1 && this.m[y][x]<=100){
				    if(y==0)	content+="U";
				    else if (y==9) content+="D";
				    if(x==0)	content+="L";
				    else if (x==9) content+="R";
			    }else { continue; }
			    let ty=y+result[content][Math.floor(Math.random())*result[content].length][Math.floor(Math.random())];  //???
			    let tx=x+result[content][Math.floor(Math.random())*result[content].length][Math.floor(Math.random())];
			    if(this.m[ty][tx]==-1){
				    this.m[ty][tx]=this.m[y][x] +100;  //use +100 to distinguish moved and not moved
				    this.m[y][x]=-1;
			    }else{  
				    this.m[ty][tx]= game(this.m[ty][tx] , this.m[y][x])+100;  
				    this.m[y][x]=-1;
			    }
		    }
	    }
		for(let i=0;i<10;i++)     // -100
			for(let j=0;j<10;j++)
				if(this.m[i][j]>=100)
					this.m[i][j]-=100;
    }
}
class people{
	contructor(){
		this.win=0;
	}
}
function done(map){  // check whether it is done yet
	let t=0;
	for(let i=0;i<10;i++)
		for(let j=0;j<10;j++){
			t+=map.m[i][j];
			if(t!=-1)
				t++;
		}
    if(t==1)
	    return 1;
    else
        return 0;
}
function game(A,B){  //return the winner
	let content={};
	let result={
		"scst" : B,
		"scpa" : A,
		"scsc" : "T",
		"past" : A,
		"papa" : "T",
		"pasc" : B,
		"stst" : "T",
		"stpa" : B,
		"stsc" :A
	};   
	content=  ["st","pa","sc"][Math.floor(Math.random())*3]   +   ["st","pa","sc"][Math.floor(Math.random())*3];
	if(result[content] == A){
		crowd[A].win++;     //crowd is created in main, can it be called here ?
		return A;
	}
	else if(result[content] == B){
		crowd[B].win++;
		return B;
	}
	else if(result[content]=="T")
		return game(A,B);
}  

</script> 
</body>

</html>